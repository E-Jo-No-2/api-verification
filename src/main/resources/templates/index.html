<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Planner</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="header">
        <h1>즐겨찾기</h1>
        <p class="date-time" id="date-time"></p>
    </div>

    <!-- Weather Section -->
    <div class="weather">
        <div id="weather-data" style="display: flex; justify-content: space-around;">날씨 정보를 불러오는 중...</div>
    </div>

    <!-- Cards Section -->
    <div class="cards" id="cards">
        <!-- Tour Cards will be dynamically added here -->
        <a href="#" class="card new-card" id="new-planner-btn">
            <h2>NEW ➕</h2>
        </a>
    </div>
</div>

<script src="jsp/script.js"></script>
<script>
    function updateDateTime() {
        const days = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
        const months = ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"];

        const now = new Date();
        const day = days[now.getDay()];
        const date = now.getDate();
        const month = months[now.getMonth()];
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');

        document.getElementById("date-time").innerText = `${year}년 ${month} ${date}일 (${day}) ${hours}:${minutes}`;
    }

    // 페이지 로드 시 및 매 분마다 날짜 및 시간 업데이트
    updateDateTime();
    setInterval(updateDateTime, 60000);

    document.addEventListener("DOMContentLoaded", () => {
        loadPlanners();

        // Add event listener for the "New Planner" button
        document.getElementById("new-planner-btn").addEventListener("click", createPlanner);
    });

    function loadPlanners() {
        fetch("/planners")
            .then(response => {
                if (!response.ok) throw new Error("Failed to fetch planners");
                return response.json();
            })
            .then(planners => {
                const cardsContainer = document.getElementById("cards");
                cardsContainer.innerHTML = ""; // Clear existing cards

                planners.forEach(planner => {
                    const card = document.createElement("div");
                    card.className = "card";
                    card.innerHTML = `
                    <h3>${planner.theme_name}</h3>
                    <p>Start Date: ${planner.start_date}</p>
                    <p>Landmark: ${planner.landmark_id}</p>
                    <button onclick="deletePlanner(${planner.planner_id})">Delete</button>
                `;
                    cardsContainer.appendChild(card);
                });

                // Add the "New Planner" card
                const newCard = document.createElement("a");
                newCard.href = "#";
                newCard.className = "card new-card";
                newCard.innerHTML = `<h2>NEW ➕</h2>`;
                newCard.addEventListener("click", createPlanner);
                cardsContainer.appendChild(newCard);
            })
            .catch(error => console.error("Error loading planners:", error));
    }

    function createPlanner() {
        const themeName = prompt("Enter theme name:");
        const startDate = prompt("Enter start date (YYYY-MM-DD):");
        const landmarkId = prompt("Enter landmark ID:");

        const planner = {
            theme_name: themeName,
            start_date: startDate,
            landmark_id: parseInt(landmarkId, 10),
            user_id: "123" // Replace with actual user ID
        };

        fetch("/planners", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(planner),
        })
            .then(response => {
                if (!response.ok) throw new Error("Failed to create planner");
                alert("Planner created successfully!");
                loadPlanners(); // Reload planners after creation
            })
            .catch(error => console.error("Error creating planner:", error));
    }

    function deletePlanner(plannerId) {
        if (!confirm("Are you sure you want to delete this planner?")) return;

        fetch(`/planners/${plannerId}`, {
            method: "DELETE",
        })
            .then(response => {
                if (!response.ok) throw new Error("Failed to delete planner");
                alert("Planner deleted successfully!");
                loadPlanners(); // Reload planners after deletion
            })
            .catch(error => console.error("Error deleting planner:", error));
    }

</script>
</body>
</html>
