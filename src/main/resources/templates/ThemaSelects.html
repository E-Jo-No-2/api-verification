<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관광지 선택</title>
    <link rel="stylesheet" href="../css/Themaselect.css">
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=zf3b8gnmu2"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100vh;
        }
        .sidebar {
            width: 25%;
            padding: 20px;
            background-color: #f8f9fa;
            border-right: 1px solid #ddd;
        }
        .sidebar h3 {
            margin: 0 0 10px 0;
        }
        #tourList {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
        }
        #tourList li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .tour-item {
            flex-grow: 1; /* 텍스트 영역이 가변적으로 늘어나도록 설정 */
            margin-right: 10px; /* 버튼과 간격을 유지 */
            text-align: left; /* 텍스트 정렬 */
        }

        .edit-btn, .delete-btn {
            width: 50px; /* 버튼 크기를 고정 */
            padding: 5px 10px;
            font-size: 12px;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            text-align: center; /* 버튼 텍스트 가운데 정렬 */
        }

        .edit-btn {
            background-color: #ffc107; /* 수정 버튼 색상 */
        }

        .edit-btn:hover {
            background-color: #e0a800;
        }

        .delete-btn {
            background-color: #dc3545; /* 삭제 버튼 색상 */
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        #tourList li button {
            margin-left: 5px;
        }
        #memo {
            width: 100%; /* 너비를 그대로 유지 */
            height: 100px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            margin-left: -10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            background-color: #f8f9fa;
        }
        #backBtn {
            margin-top: 10px;
            margin-left: 0; /* 버튼을 왼쪽 정렬 */
            padding: 10px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            width: 100px; /* 고정된 너비 설정 */
        }

        #backBtn:hover {
            background: #0056b3;
        }
        .map-container {
            flex: 1;
            padding: 20px;
        }
        #map {
            width: 99%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
        }
        .button-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        #backBtnBelow, #completeBtn {
            padding: 10px;
            width: 48%;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        #backBtnBelow {
            background-color: #007bff;
            color: #fff;
        }
        #backBtnBelow:hover {
            background-color: #0056b3;
        }
        #completeBtn {
            background-color: #007bff;
            color: #fff;
        }
        #completeBtn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- 왼쪽 메뉴 -->
    <div class="sidebar">
        <h3>MY TOUR LIST</h3>
        <ul id="tourList">
            <!-- 클릭된 관광지 이름이 여기에 추가됨 -->
        </ul>
        <h3>계획 메모</h3>
        <textarea id="memo" placeholder="메모를 입력하세요..."></textarea>
        <button id="backBtn">작성 완료</button>
    </div>
    <!-- 지도 섹션 -->
    <div class="map-container">
        <h3>관광지 지도</h3>
        <label for="themeSelect">테마 선택:</label>
        <select id="themeSelect" onchange="filterByTheme()">
            <option value="">모든 테마</option>
            <option value="문화 관광">문화 관광</option>
            <option value="실내">실내</option>
            <option value="전통/문화 거리">전통/문화 거리</option>
        </select>
        <div id="map"></div>
        <div class="button-container">
            <button id="backBtnBelow" onclick="goBack()">뒤로가기</button>
            <button id="completeBtn" onclick="completeTour()">완료</button>
        </div>
    </div>
</div>

<script>
    var map = new naver.maps.Map("map", {
        center: new naver.maps.LatLng(37.5665, 126.9780),
        zoom: 12
    });

    var locations = [];
    var markers = [];

    // JSON 데이터 로드
    fetch('location_data.json')
        .then(response => response.json())
        .then(data => {
            locations = data;
            addMarkers(locations);
        })
        .catch(error => console.error("Error loading JSON data:", error));

    function addMarkers(filteredLocations) {
        markers.forEach(marker => marker.setMap(null));
        markers = [];
        filteredLocations.forEach(function(location) {
            var marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(location.x, location.y),
                map: map,
                title: location.location
            });
            naver.maps.Event.addListener(marker, 'click', function () {
                addToTourList(location.location);
            });
            markers.push(marker);
        });
    }

    function addToTourList(locationName) {
        var tourList = document.getElementById("tourList");
        var listItem = document.createElement("li");
        var textSpan = document.createElement("span");
        textSpan.textContent = `${tourList.children.length + 1}. ${locationName}`;
        textSpan.className = "tour-item";

        var editBtn = document.createElement("button");
        editBtn.textContent = "수정";
        editBtn.className = "edit-btn";
        editBtn.onclick = function () {
            var newName = prompt("새로운 이름을 입력하세요:", locationName);
            if (newName) {
                textSpan.textContent = `${tourList.children.length}. ${newName}`;
            }
        };

        var deleteBtn = document.createElement("button");
        deleteBtn.textContent = "삭제";
        deleteBtn.className = "delete-btn";
        deleteBtn.onclick = function () {
            tourList.removeChild(listItem);
            updateTourListNumbers();
        };

        listItem.appendChild(textSpan);
        listItem.appendChild(editBtn);
        listItem.appendChild(deleteBtn);
        tourList.appendChild(listItem);
    }

    function updateTourListNumbers() {
        var tourList = document.getElementById("tourList");
        var items = tourList.getElementsByTagName("li");
        for (var i = 0; i < items.length; i++) {
            var textSpan = items[i].getElementsByClassName("tour-item")[0];
            var itemText = textSpan.textContent.split(". ")[1];
            textSpan.textContent = `${i + 1}. ${itemText}`;
        }
    }

    function filterByTheme() {
        var selectedTheme = document.getElementById("themeSelect").value;
        var filteredLocations = locations.filter(function(location) {
            return selectedTheme === "" || location.theme === selectedTheme;
        });
        addMarkers(filteredLocations);
    }

    function goBack() {
        alert("뒤로 가시겠습니까?");
    }

    function completeTour() {
        alert("플래너 작성 완료를 하시겠습니까?");
    }
</script>
</body>
</html>
